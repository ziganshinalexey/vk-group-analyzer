!function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="../",o(o.s=4)}([function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findClosest=function(e,t){var o=document.querySelectorAll(t),n=e;for(;n;){var r=null;if(o.forEach(function(e){n===e&&(r=e)}),r)return n;n=n.parentNode}return null},t.findElLastParentNode=function(e,t){var o=e;for(;o&&o.parentNode;){var n=o.parentNode;if(n===t)return o;o=n}return null},t.getDataAttrName=function(e){return e?"data-"+e:null},t.selectWithAttr=function(e,t){return e?"["+e+'="'+t+'"]':""},t.getUTCTime=function(){var e=(new Date).getTime(),t=6e4*(new Date).getTimezoneOffset();return e-t},t.normalizeDate=function(e){return e.replace(/-/g,"/")},t.getOrientationAffix=function(e){switch(e){case"horizontal":return"h";case"vertical":return"v";default:return""}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkCarousel=t.changeSlide=t.drawCarousel=void 0;var n=o(0),r=(t.drawCarousel=function(e){var t=e.props,o=e.section;if(o){var i=o.$,a=o.orientation,l=document.createElement("div"),c=document.createElement("div"),s=document.createElement("div"),d=document.createElement("div"),u=document.createElement("div"),f=document.createElement("div"),p=(0,n.getOrientationAffix)(a);l.className=t.carouselClass+" "+t.carouselClass+"-"+p,c.className=t.carouselTrackClass,s.className=t.carouselInnerClass,d.className=t.carouselControlsClass,f.className=t.carouselControlBackwardClass,u.className=t.carouselControlForwardClass,d.appendChild(f),d.appendChild(u),l.appendChild(d),c.appendChild(s),l.appendChild(c),i.appendChild(l),o.carousel={$:l,$backward:f,$controls:d,$forward:u,$inner:s,blocked:t.carouselDefaultBlocked,infoBlocks:{},slide:t.carouselDefaultSlide},r({props:t,section:o})}},t.changeSlide=function(e){var t=e.diff,o=e.section,n=o.amount,r=o.carousel,i=o.carousel,a=i.$inner,l=i.blocked,c=i.infoBlocks,s=i.slide,d=o.orientation;if(!l){var u=null;switch(d){case"horizontal":u="X";break;case"vertical":u="Y"}var f=Object.keys(c).length,p=Math.max(f-n+1,1),v=s+t,k=s;switch(!0){case 0>t:k=1===s?p:v;break;case 0<t:k=p===s?1:v}if(k!==s){r.slide=k;var m=1/n*-(k-1)*100;a.style.transform="translate"+u+"("+m+"%)"}}},t.checkCarousel=function(e){var t=e.props,o=e.section,n=o.amount,r=o.carousel,i=o.carousel,a=i.$,l=i.$inner,c=i.blocked,s=i.infoBlocks,d=Object.keys(s).length<=n;c!==d&&(r.blocked=d,d&&(r.slide=t.carouselDefaultSlide,l.style.transform=null),a.setAttribute(t.iBSectionAttrBlocked,d?t.iBSectionAttrBlockedTrue:t.iBSectionAttrBlockedFalse))})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.metricsClickVideo=t.metricsClickInfoBlock=void 0;var n=o(0);t.metricsClickInfoBlock=function(e){var t=e.infoBlock,o=e.props;if(t){var r=o.channelId,i=o.layoutId,a=o.videoId,l=t.blockName,c=t.infoBlockId,s=t.infoBlockScheduleId,d=new XMLHttpRequest;d.open("POST",o.host+"/api/v1/info-block-click",!0),d.setRequestHeader("x-http-method-override","CREATE"),d.setRequestHeader("Content-Type","application/json"),d.withCredentials=!0,d.send(JSON.stringify({blockName:l,channelId:r,clickDate:(0,n.getUTCTime)(),infoBlockId:c,infoBlockScheduleId:s,layoutId:i,videoId:a}))}},t.metricsClickVideo=function(e){var t=e.props,o=e.structure,r=o.layout,i=o.video;if(r&&i){var a=t.channelId,l=t.userId,c=t.userAge,s=t.userLocation,d=t.platform,u=r.id,f=i.id,p=new XMLHttpRequest;p.open("POST",t.host+"/api/v1/video-click",!0),p.setRequestHeader("x-http-method-override","CREATE"),p.setRequestHeader("Content-Type","application/json"),p.withCredentials=!0,p.send(JSON.stringify({channelId:a,clickDate:(0,n.getUTCTime)(),layoutId:u,platform:d,userAge:c,userId:l,userLocation:s,videoId:f}))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.drawModal=function(e){var t=e.props,o=e.structure;if(o.modal){var n=document.querySelector(t.iBModalSelector);if(n){var r=document.createElement("div"),i=document.createElement("div");n.setAttribute("hidden","true"),r.className=t.iBModalCloseClass,i.className=t.iBModalContentClass,n.appendChild(r),n.appendChild(i),o.modal={$:n,$close:r,$content:i,isOpened:!1}}}},t.drawModalContents=function(e){var t=e.infoBlock,o=e.props,n=e.structure;if(t){var r=n.modal.$content;if(r){var i=t.title,a=t.fullDescription,l=t.shortDescription;if(i){var c=document.createElement("div");c.className=o.iBModalTitleClass,c.innerHTML=i,r.appendChild(c)}if(l){var s=document.createElement("div");s.className=o.iBModalShortDescriptionClass,s.innerHTML=l,r.appendChild(s)}if(a){var d=document.createElement("div");d.className=o.iBModalFullDescriptionClass,d.innerHTML=a,r.appendChild(d)}}}},t.clearModalContents=function(e){var t=e.structure.modal.$content;t&&(t.innerHTML=null)}},function(e,t,o){o(5),e.exports=o(6)},function(e,t,o){},function(e,t,o){"use strict";var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},r=o(1),i=o(7),a=o(8),l=o(9),c=o(3),s=o(0),d=o(2);window.initTouchTv=function(e,t){var o=n({},i.DEFAULT_OPTIONS,e),u={container:{},infoBlockList:[],infoBlockScheduleList:[],layout:{},modal:{},sections:{},video:{}},f=new XMLHttpRequest;f.open("POST",o.host+"/api/v1/layout/current",!0),f.setRequestHeader("x-http-method-override","GET"),f.setRequestHeader("Content-Type","application/json"),f.onreadystatechange=function(){if(4===f.readyState&&200===f.status){var e=JSON.parse(f.responseText).data;window.iBRefresh&&window.clearInterval(window.iBRefresh),window.iBRefresh=null,e&&(0,l.drawLayout)({callback:function(){!function e(t){var n=u.layout;if(n){var i=n.$,l=t.infoBlockList,f=t.infoBlockScheduleList,p=t.video;if(u.infoBlockList=l,u.infoBlockScheduleList=f,Object.keys(u.video).length||(u.video=p,(0,d.metricsClickVideo)({props:o,structure:u})),Object.keys(u.modal).length||(0,c.drawModal)({props:o,structure:u}),!Object.keys(u.sections).length){var v=i.querySelectorAll(o.iBSectionSelector);v&&v.forEach(function(e){var t=e.getAttribute((0,s.getDataAttrName)(o.iBSectionAttrAmount)),n=e.getAttribute((0,s.getDataAttrName)(o.iBSectionAttrId)),i={$:e,amount:t,id:n,orientation:e.getAttribute((0,s.getDataAttrName)(o.iBSectionAttrOrientation))};u.sections[n]=i,(0,r.drawCarousel)({props:o,section:i})})}f.forEach(function(e){(0,a.handleInfoBlock)({infoBlock:e,props:o,structure:u})}),window.iBRefresh||(window.iBRefresh=window.setInterval(function(){e(t)},o.iBRefreshInterval))}}(e),t&&t()},data:e,props:o,structure:u})}},f.withCredentials=!0,f.send(JSON.stringify({channelId:o.channelId,time:o.time}))},window.destroyTouchTv=function(e,t){var o=n({},i.DEFAULT_OPTIONS,e);window.iBRefresh=null;var r=document.querySelector(o.containerSelector);r&&(r.innerHTML="",t&&t())},window.setTimeTouchTv=function(e,t){window.timeTouchTv=e,t&&t()}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_OPTIONS=void 0;var n=o(0);t.DEFAULT_OPTIONS={carouselClass:"carousel",carouselControlBackwardClass:"carousel-control carousel-control-backward",carouselControlForwardClass:"carousel-control carousel-control-forward",carouselControlsClass:"carousel-controls",carouselDefaultBlocked:!1,carouselDefaultSlide:1,carouselHorizontalClass:"carousel-h",carouselInnerClass:"carousel-inner g-h-xs-10 g-h-lg-20 g-v-xs-10 g-v-lg-20",carouselSlideClass:"carousel-slide",carouselTrackClass:"carousel-track",carouselVerticalClass:"carousel-v",containerSelector:"body",emptySpaceSelector:".j-empty-space",host:"http://demo.touch-tv-front.stands.userstory.ru",iBBackdropClass:"info-block-backdrop",iBBackdropClassFull:"info-block-backdrop-full",iBBgColor:"#315efb",iBClass:"info-block j-info-block",iBModalAttrHidden:"hidden",iBModalAttrHiddenFalse:"false",iBModalAttrHiddenTrue:"true",iBModalCloseClass:"info-block-modal-close",iBModalContentClass:"info-block-modal-content",iBModalFullDescriptionClass:"info-block-modal-full-description",iBModalSelector:".j-info-block-modal",iBModalShortDescriptionClass:"info-block-modal-short-description",iBModalTitleClass:"info-block-modal-title",iBRefreshInterval:1e3,iBSectionAttrAmount:"amount",iBSectionAttrBlocked:"blocked",iBSectionAttrBlockedFalse:"false",iBSectionAttrBlockedTrue:"true",iBSectionAttrId:"id",iBSectionAttrOrientation:"orientation",iBSectionSelector:".j-info-block-section",iBSelector:".j-info-block",iBShortDescriptionClass:"info-block-short-description",iBTitleClass:"info-block-title",iBTitleClassAlign:"info-block-title-align",iBTitleInnerClass:"info-block-title-inner",iBWrapperClass:"info-block-wrapper",layoutSelector:".j-layout",time:(0,n.getUTCTime)(),videoSelector:".j-video"}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleInfoBlock=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},r=o(1),i=o(2),a=o(0);function l(e,t){var o={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(o[n]=e[n]);return o}t.handleInfoBlock=function(e){var t=e.infoBlock,o=e.props,d=e.structure,u=d.sections,f=t.id,p=l(t,["id"]),v=p.blockName,k=p.infoBlockId,m=p.from,B=p.to,h=Object.keys(u).find(function(e){return u[e].id===v});if(h){var C=u[h],b=C.carousel;if(b){var y=b.$inner,w=b.infoBlocks,S=Object.keys(w).find(function(e){return w[e].infoBlockScheduleId===f}),O=window.timeTouchTv?new Date(window.timeTouchTv):new Date,T=new Date((0,a.normalizeDate)(m)),g=new Date((0,a.normalizeDate)(B));if(O>T&&O<g){if(!S){var M=C.amount,A=C.orientation,I=document.createElement("div"),j=document.createElement("div"),N="col col-"+(0,a.getOrientationAffix)(A)+"-xs-"+Math.round(24/M),D=d.infoBlockList.find(function(e){return e.id===k}),E=(D.id,l(D,["id"]));E=n({blockName:v,infoBlockId:k,infoBlockScheduleId:f},E),j.className=o.iBWrapperClass+" "+o.carouselSlideClass+" "+N,I.className=o.iBClass,j.appendChild(I),y.appendChild(j);var L=n({$:I},E);b.infoBlocks[f]=L,s({infoBlock:L,props:o}),(0,r.checkCarousel)({props:o,section:C}),(0,i.metricsClickInfoBlock)({infoBlock:L,props:o})}}else S&&c({infoBlock:w[S],props:o,section:C})}}};var c=function(e){var t=e.infoBlock,o=e.props,i=e.section,l=i.carousel,c=i.carousel,s=c.$inner,d=c.infoBlocks,u=t.$,f=t.infoBlockScheduleId,p=(0,a.findElLastParentNode)(u,s);p&&(s.removeChild(p),l.infoBlocks=Object.keys(d).reduce(function(e,t){return d[t].infoBlockScheduleId!==f?n({},e,function(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}({},t,d[t])):e},{}),(0,r.checkCarousel)({props:o,section:i}))},s=function(e){var t=e.infoBlock,o=e.props;if(t){var n=t.$,r=t.image,i=t.shortDescription,a=t.title,l=!!a,c=!!i;if(r?n.style.backgroundImage="url("+r+")":n.style.backgroundColor=o.iBBgColor,l||c){var s=document.createElement("div"),d=o.iBBackdropClass;c&&(d=d+" "+o.iBBackdropClassFull),s.className=d,n.appendChild(s)}if(l){var u=document.createElement("div"),f=document.createElement("div"),p=o.iBTitleClass;c||(p=p+" "+o.iBTitleClassAlign,f.className=o.iBTitleInnerClass),u.className=p,f.textContent=a,u.appendChild(f),n.appendChild(u)}if(c){var v=document.createElement("div");v.className=o.iBShortDescriptionClass,v.textContent=i,n.appendChild(v)}}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.drawLayout=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},r=o(10);t.drawLayout=function(e){var t=e.callback,o=e.data,i=e.props,a=e.structure,l=o.layout;if(l){var c=l.src,s=document.querySelector(i.containerSelector);if(s&&c){a.container={$:s},s.innerHTML=c;var d=document.querySelector(i.layoutSelector);a.layout=n({$:d},l),document.addEventListener("click",function(e){return(0,r.handleClick)({e:e,props:i,structure:a})},!0),t&&t()}}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleClick=void 0;var n=o(1),r=o(2),i=o(3),a=o(0);t.handleClick=function(e){var t=e.e,o=e.props,l=e.structure,c=t.target,s=l.modal.$;if(s){var d=l.modal,u=d.$close,f=d.isOpened,p=l.sections,v=(0,a.findClosest)(c,o.iBSelector),k=!!(0,a.findClosest)(c,o.iBModalSelector),m={};switch(Object.keys(p).forEach(function(e){var t=p[e],o=t.carousel;if(o.$backward===c&&(m={infoBlock:void 0,section:t,type:"backward"}),o.$forward===c&&(m={infoBlock:void 0,section:t,type:"forward"}),v){var n=o.infoBlocks,r=Object.keys(n).find(function(e){return n[e].$===v});if(r){var i=n[r];m={infoBlock:i,section:t,type:"slide"}}}}),!0){case!(!f||c!==u&&k):l.modal.isOpened=!1,s.setAttribute(o.iBModalAttrHidden,o.iBModalAttrHiddenTrue),(0,i.clearModalContents)({structure:l});break;case!(f||!m.infoBlock):var B=m.infoBlock;(0,i.drawModalContents)({infoBlock:B,props:o,structure:l}),l.modal.isOpened=!0,s.setAttribute(o.iBModalAttrHidden,o.iBModalAttrHiddenFalse),(0,r.metricsClickInfoBlock)({infoBlock:B,props:o});break;case"backward"===m.type:var h=m.section;(0,n.changeSlide)({diff:-1,section:h});break;case"forward"===m.type:var C=m.section;(0,n.changeSlide)({diff:1,section:C})}}}}]);
//# sourceMappingURL=main.min.js.map?d4dcc5f9